<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PDP Panel V1</title>
<style>
  :root{
    --bg1:#0b1020;
    --bg2:#071427;
    --card:#0f1728;
    --muted:#9aa6bf;
    --accent:#7c3aed;
  }
  *{
    box-sizing:border-box;
    margin:0;
    padding:0;
  }
  body{
    font-family:system-ui,-apple-system,sans-serif;
    background:linear-gradient(135deg,#667eea 0%,#764ba2 25%,#f093fb 50%,#4facfe 75%,#00f2fe 100%);
    background-size:400% 400%;
    animation:gradient 15s ease infinite;
    color:#fff;
    min-height:100vh;
    padding:2rem;
  }
  @keyframes gradient{
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
  }
  .container{
    max-width:1400px;
    margin:0 auto;
  }
  header{
    background:rgba(255,255,255,0.05);
    backdrop-filter:blur(20px);
    border-radius:16px;
    padding:1.5rem 2rem;
    margin-bottom:2rem;
    border:1px solid rgba(255,255,255,0.1);
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  nav{
    display:flex;
    gap:1rem;
    margin-bottom:2rem;
    background:rgba(255,255,255,0.05);
    backdrop-filter:blur(20px);
    padding:1rem;
    border-radius:16px;
    border:1px solid rgba(255,255,255,0.1);
  }
  .nav-btn{
    padding:0.75rem 1.5rem;
    background:transparent;
    color:#fff;
    border:none;
    border-radius:12px;
    cursor:pointer;
    font-size:1rem;
    font-weight:500;
    transition:all 0.3s ease;
  }
  .nav-btn:hover{
    background:rgba(255,255,255,0.1);
  }
  .nav-btn.active{
    background:var(--accent);
    box-shadow:0 4px 20px rgba(124,58,237,0.4);
  }
  .card{
    background:rgba(255,255,255,0.05);
    backdrop-filter:blur(20px);
    border-radius:16px;
    padding:2rem;
    border:1px solid rgba(255,255,255,0.1);
    margin-bottom:2rem;
  }
  .view{
    display:none;
  }
  .view.active{
    display:block;
  }
  .form-group{
    margin-bottom:1.5rem;
  }
  .form-group label{
    display:block;
    margin-bottom:0.5rem;
    font-weight:500;
    color:var(--muted);
  }
  .form-group input{
    width:100%;
    padding:0.875rem;
    background:rgba(255,255,255,0.05);
    border:1px solid rgba(255,255,255,0.1);
    border-radius:8px;
    color:#fff;
    font-size:1rem;
  }
  .form-group input:focus{
    outline:none;
    border-color:var(--accent);
  }
  button[type="submit"]{
    padding:1rem 2rem;
    background:linear-gradient(135deg,var(--accent),#3b82f6);
    color:#fff;
    border:none;
    border-radius:8px;
    font-size:1rem;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s ease;
  }
  button[type="submit"]:hover{
    transform:translateY(-2px);
    box-shadow:0 8px 25px rgba(124,58,237,0.4);
  }
  .stats-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:1.5rem;
    margin-top:2rem;
  }
  .stat-card{
    padding:1.5rem;
    background:rgba(255,255,255,0.05);
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.1);
  }
  .stat-value{
    font-size:2rem;
    font-weight:700;
    margin-bottom:0.5rem;
  }
  .stat-label{
    color:var(--muted);
    font-size:0.875rem;
  }
  .log-container{
    background:rgba(0,0,0,0.3);
    border-radius:8px;
    padding:1rem;
    max-height:400px;
    overflow-y:auto;
    font-family:monospace;
    font-size:0.875rem;
  }
  .log-entry{
    padding:0.5rem;
    margin-bottom:0.5rem;
    border-radius:4px;
    border-left:3px solid #10b981;
  }
  .log-entry.error{
    border-left-color:#ef4444;
  }
  .pulse{
    animation:pulse 2s cubic-bezier(0.4,0,0.6,1) infinite
  }
  @keyframes pulse{
    0%,100%{opacity:1}
    50%{opacity:0.5}
  }
  .category-card{
    padding:2rem;
    background:rgba(255,255,255,0.03);
    border-radius:16px;
    border:1px solid rgba(255,255,255,0.1);
    cursor:pointer;
    transition:all 0.3s ease;
    position:relative;
    overflow:hidden
  }
  .category-card:hover{
    background:rgba(255,255,255,0.06);
    border-color:var(--accent);
    transform:translateY(-4px);
    box-shadow:0 12px 40px rgba(124,58,237,0.3)
  }
  .category-icon{
    font-size:3rem;
    margin-bottom:1rem;
    display:inline-block;
    transition:transform 0.3s ease
  }
  .category-card:hover .category-icon{
    transform:scale(1.1) rotate(5deg)
  }
  .category-card h3{
    margin:0 0 0.5rem;
    font-size:1.5rem;
    font-weight:700
  }
  .category-card p{
    color:var(--muted);
    margin:0 0 1rem;
    line-height:1.6
  }
  .category-badge{
    display:inline-block;
    padding:0.375rem 0.875rem;
    background:linear-gradient(135deg,var(--accent),#3b82f6);
    border-radius:20px;
    font-size:0.75rem;
    font-weight:600;
    text-transform:uppercase;
    letter-spacing:0.05em
  }
  .explanation-step{
    display:flex;
    gap:1.5rem;
    padding:1.5rem;
    background:rgba(255,255,255,0.03);
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.1);
    transition:all 0.3s ease
  }
  .explanation-step:hover{
    background:rgba(255,255,255,0.06);
    border-color:rgba(124,58,237,0.5)
  }
  .step-number{
    flex-shrink:0;
    width:48px;
    height:48px;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(135deg,var(--accent),#3b82f6);
    border-radius:50%;
    font-size:1.5rem;
    font-weight:700
  }
  .step-content h3{
    margin:0 0 0.75rem;
    font-size:1.25rem;
    font-weight:600
  }
  .step-content p{
    margin:0 0 1rem;
    color:var(--muted);
    line-height:1.6
  }
  .step-content ul{
    margin:0;
    padding-left:1.5rem;
    color:var(--muted);
    line-height:1.8
  }
  .step-content ul li{
    margin-bottom:0.5rem
  }
  #loginScreen{
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:100vh;
  }
  .login-card{
    background:rgba(255,255,255,0.1);
    backdrop-filter:blur(20px);
    border-radius:24px;
    padding:3rem;
    border:1px solid rgba(255,255,255,0.2);
    text-align:center;
    max-width:400px;
    width:100%;
  }
  .login-card h1{
    font-size:2.5rem;
    margin-bottom:0.5rem;
  }
  .login-card p{
    color:var(--muted);
    margin-bottom:2rem;
  }
  .discord-btn{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:0.75rem;
    width:100%;
    padding:1rem 2rem;
    background:#5865F2;
    color:#fff;
    border:none;
    border-radius:8px;
    font-size:1.125rem;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s ease;
  }
  .discord-btn:hover{
    background:#4752C4;
    transform:translateY(-2px);
    box-shadow:0 8px 25px rgba(88,101,242,0.4);
  }
</style>
</head>
<body>
  <div id="loginScreen">
    <div class="login-card">
      <h1>ü§ñ</h1>
      <h1>PDP Panel V1</h1>
      <p>Connectez-vous avec Discord pour acc√©der au panel d'administration</p>
      <button class="discord-btn" onclick="loginWithDiscord()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
        </svg>
        Se connecter avec Discord
      </button>
    </div>
  </div>

  <div id="mainApp" style="display:none">
    <div class="container">
      <header>
        <div style="display:flex;align-items:center;gap:1rem">
          <div style="font-size:2rem">ü§ñ</div>
          <div>
            <h1 style="margin:0;font-size:1.75rem;font-weight:700">PDP Panel V1</h1>
            <p style="margin:0.25rem 0 0;color:var(--muted);font-size:0.875rem">Panel d'administration du bot Discord</p>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:1.5rem">
          <div id="botStatusMini" style="display:flex;align-items:center;gap:0.5rem;padding:0.5rem 1rem;background:rgba(124,58,237,0.1);border-radius:8px;border:1px solid rgba(124,58,237,0.3)">
            <div class="pulse" style="width:8px;height:8px;background:#10b981;border-radius:50%"></div>
            <span style="color:var(--muted);font-size:0.875rem">Bot: <span id="statusTextMini">En ligne</span></span>
          </div>
          <div id="userInfo" style="display:none;align-items:center;gap:1rem">
            <img id="userAvatar" style="width:40px;height:40px;border-radius:50%;border:2px solid var(--accent)">
            <span id="userName" style="color:var(--muted)"></span>
            <button onclick="logout()" style="padding:0.5rem 1rem;background:rgba(124,58,237,0.2);color:var(--accent);border:1px solid var(--accent);border-radius:8px;cursor:pointer">
              D√©connexion
            </button>
          </div>
        </div>
      </header>

      <nav>
        <button class="nav-btn active" data-view="home">üè† Accueil</button>
        <button class="nav-btn" data-view="explanation">üìñ Explication</button>
        <button class="nav-btn" data-view="import">üì• Importer</button>
        <button class="nav-btn" data-view="dashboard">üìä Dashboard</button>
        <button class="nav-btn" data-view="logs">üìù Logs</button>
      </nav>

      <div id="homeView" class="view active">
        <div class="card">
          <h2 style="display:flex;align-items:center;gap:0.75rem;margin-bottom:2rem">
            <span>üè†</span>
            Cat√©gories
          </h2>
          
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem">
            <div class="category-card" onclick="switchView('import')">
              <div class="category-icon">üì•</div>
              <h3>Importer</h3>
              <p>Scraper et importer des photos de profil Discord depuis un serveur</p>
              <div class="category-badge">Scraping</div>
            </div>

            <div class="category-card" onclick="switchView('dashboard')">
              <div class="category-icon">üìä</div>
              <h3>Dashboard</h3>
              <p>Consulter les statistiques et l'√©tat du syst√®me en temps r√©el</p>
              <div class="category-badge">Statistiques</div>
            </div>

            <div class="category-card" onclick="switchView('logs')">
              <div class="category-icon">üìù</div>
              <h3>Logs</h3>
              <p>Visualiser l'historique des op√©rations et les messages syst√®me</p>
              <div class="category-badge">Console</div>
            </div>

            <div class="category-card" onclick="switchView('explanation')">
              <div class="category-icon">üìñ</div>
              <h3>Explication</h3>
              <p>Guide d'utilisation et documentation du panel</p>
              <div class="category-badge">Aide</div>
            </div>
          </div>
        </div>
      </div>

      <div id="explanationView" class="view">
        <div class="card">
          <h2 style="display:flex;align-items:center;gap:0.75rem">
            <span>üìñ</span>
            Comment √ßa marche ?
          </h2>
          
          <div style="display:flex;flex-direction:column;gap:2rem;margin-top:2rem">
            <div class="explanation-step">
              <div class="step-number">1</div>
              <div class="step-content">
                <h3>üì• Importer des photos</h3>
                <p>Rendez-vous dans la section <strong>Importer</strong> pour scraper les photos de profil d'un serveur Discord.</p>
                <ul>
                  <li>Entrez l'ID du serveur Discord</li>
                  <li>Cliquez sur "D√©marrer l'import"</li>
                  <li>Le bot va scraper automatiquement toutes les photos de profil des membres</li>
                </ul>
              </div>
            </div>

            <div class="explanation-step">
              <div class="step-number">2</div>
              <div class="step-content">
                <h3>üìä Suivre la progression</h3>
                <p>Consultez le <strong>Dashboard</strong> pour voir les statistiques en temps r√©el :</p>
                <ul>
                  <li>Nombre total de photos scrap√©es</li>
                  <li>Nombre de serveurs analys√©s</li>
                  <li>Derni√®re activit√©</li>
                  <li>Statut du bot</li>
                </ul>
              </div>
            </div>

            <div class="explanation-step">
              <div class="step-number">3</div>
              <div class="step-content">
                <h3>üìù Consulter les logs</h3>
                <p>La section <strong>Logs</strong> vous permet de :</p>
                <ul>
                  <li>Voir l'historique de toutes les op√©rations</li>
                  <li>D√©tecter les erreurs √©ventuelles</li>
                  <li>Suivre l'activit√© du bot en temps r√©el</li>
                </ul>
              </div>
            </div>

            <div style="padding:1.5rem;background:linear-gradient(135deg,rgba(59,130,246,0.1),rgba(124,58,237,0.1));border-radius:12px;border:1px solid rgba(59,130,246,0.3)">
              <h3 style="margin:0 0 1rem;display:flex;align-items:center;gap:0.5rem">
                <span>üí°</span>
                Conseils d'utilisation
              </h3>
              <ul style="margin:0;padding-left:1.5rem;color:var(--muted)">
                <li>Assurez-vous que le bot est en ligne avant de d√©marrer un import</li>
                <li>Un serveur Discord peut contenir des milliers de membres, l'import peut prendre du temps</li>
                <li>Les photos sont automatiquement sauvegard√©es dans la base de donn√©es</li>
                <li>Vous pouvez consulter les logs pour voir les d√©tails de chaque op√©ration</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div id="importView" class="view">
        <div class="card">
          <h2 style="display:flex;align-items:center;gap:0.75rem">
            <span>üì•</span>
            Importer des Photos
          </h2>
          <form id="importForm" style="margin-top:2rem">
            <div class="form-group">
              <label>ID du Serveur Discord</label>
              <input type="text" id="guildId" placeholder="123456789012345678" required>
            </div>
            <button type="submit">D√©marrer l'import</button>
          </form>
          <div id="importProgress" style="display:none;margin-top:2rem">
            <div style="background:rgba(124,58,237,0.2);border-radius:8px;height:8px;overflow:hidden">
              <div id="progressBar" style="background:linear-gradient(90deg,var(--accent),#3b82f6);height:100%;width:0%;transition:width 0.3s ease"></div>
            </div>
            <p id="progressText" style="margin-top:1rem;color:var(--muted);text-align:center"></p>
          </div>
        </div>
      </div>

      <div id="dashboardView" class="view">
        <div class="card">
          <h2 style="display:flex;align-items:center;gap:0.75rem">
            <span>üìä</span>
            Dashboard
          </h2>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="totalPhotos">0</div>
              <div class="stat-label">Photos scrap√©es</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="totalServers">0</div>
              <div class="stat-label">Serveurs analys√©s</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="lastActivity">Jamais</div>
              <div class="stat-label">Derni√®re activit√©</div>
            </div>
          </div>
        </div>
      </div>

      <div id="logsView" class="view">
        <div class="card">
          <h2 style="display:flex;align-items:center;gap:0.75rem">
            <span>üìù</span>
            Logs Syst√®me
          </h2>
          <div class="log-container" id="logContainer"></div>
        </div>
      </div>
    </div>
  </div>

<script>
    const API_URL = "https://pfpbot-8e9l.onrender.com";
    const DISCORD_CLIENT_ID = "1444812896495206592";
    const REDIRECT_URI = window.location.origin + window.location.pathname;

    function loginWithDiscord() {
      const scope = 'identify guilds.join';
      const authUrl = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=${encodeURIComponent(scope)}`;
      window.location.href = authUrl;
    }

    function logout() {
      location.reload();
    }

    async function fetchDiscordUser(token) {
      const response = await fetch('https://discord.com/api/users/@me', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      return response.json();
    }

    window.addEventListener('load', async () => {
      const fragment = window.location.hash.substr(1);
      const params = new URLSearchParams(fragment);
      const token = params.get('access_token');

      if (token) {
        const user = await fetchDiscordUser(token);
        window.location.hash = '';
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        document.getElementById('userInfo').style.display = 'flex';
        document.getElementById('userName').textContent = user.username;
        document.getElementById('userAvatar').src = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;
        
        checkBotStatus();
        setInterval(checkBotStatus, 30000);
      } else {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        checkBotStatus();
        setInterval(checkBotStatus, 30000);
      }
    });

    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        switchView(btn.dataset.view);
      });
    });

    function switchView(viewName) {
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      document.getElementById(viewName + 'View').classList.add('active');
      document.querySelector(`[data-view="${viewName}"]`).classList.add('active');
      
      if (viewName === 'dashboard') {
        updateDashboard();
      }
    }

    async function checkBotStatus() {
      try {
        const response = await fetch(`${API_URL}/status`);
        const data = await response.json();
        const statusMiniEl = document.getElementById('botStatusMini');
        const statusTextMiniEl = document.getElementById('statusTextMini');
        
        if (data.status === 'online') {
          statusMiniEl.querySelector('.pulse').style.background = '#10b981';
          statusTextMiniEl.textContent = 'En ligne';
        } else {
          statusMiniEl.querySelector('.pulse').style.background = '#ef4444';
          statusTextMiniEl.textContent = 'Hors ligne';
        }
      } catch (error) {
        const statusMiniEl = document.getElementById('botStatusMini');
        const statusTextMiniEl = document.getElementById('statusTextMini');
        statusMiniEl.querySelector('.pulse').style.background = '#ef4444';
        statusTextMiniEl.textContent = 'Hors ligne';
        addLog('Erreur lors de la v√©rification du statut du bot', 'error');
      }
    }

    document.getElementById('importForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const guildId = document.getElementById('guildId').value;
      const progressDiv = document.getElementById('importProgress');
      const progressBar = document.getElementById('progressBar');
      const progressText = document.getElementById('progressText');

      progressDiv.style.display = 'block';
      progressBar.style.width = '0%';
      progressText.textContent = 'D√©marrage de l\'import...';

      try {
        addLog(`D√©marrage de l'import pour le serveur ${guildId}`);
        const response = await fetch(`${API_URL}/scrape`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ guild_id: guildId })
        });

        const data = await response.json();
        
        if (response.ok) {
          progressBar.style.width = '100%';
          progressText.textContent = `Import termin√© ! ${data.count || 0} photos scrap√©es`;
          addLog(`Import termin√© avec succ√®s : ${data.count || 0} photos`);
          updateDashboard();
        } else {
          progressText.textContent = 'Erreur lors de l\'import';
          addLog(`Erreur lors de l'import : ${data.error}`, 'error');
        }
      } catch (error) {
        progressText.textContent = 'Erreur de connexion';
        addLog(`Erreur de connexion : ${error.message}`, 'error');
      }
    });

    async function updateDashboard() {
      try {
        const response = await fetch(`${API_URL}/stats`);
        const data = await response.json();
        
        document.getElementById('totalPhotos').textContent = data.total_photos || 0;
        document.getElementById('totalServers').textContent = data.total_servers || 0;
        document.getElementById('lastActivity').textContent = data.last_activity || 'Jamais';
      } catch (error) {
        addLog('Erreur lors de la r√©cup√©ration des statistiques', 'error');
      }
    }

    function addLog(message, type = 'info') {
      const logContainer = document.getElementById('logContainer');
      const logEntry = document.createElement('div');
      logEntry.className = `log-entry ${type}`;
      const timestamp = new Date().toLocaleTimeString('fr-FR');
      logEntry.textContent = `[${timestamp}] ${message}`;
      logContainer.insertBefore(logEntry, logContainer.firstChild);
      
      if (logContainer.children.length > 50) {
        logContainer.removeChild(logContainer.lastChild);
      }
    }
  </script>
</body>
</html>
