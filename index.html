<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PDP Panel V1</title>
<style>
  :root{
    --bg-gradient-1:#4a5568;
    --bg-gradient-2:#9ca3af;
    --card-dark:#374151;
    --card-light:#4b5563;
    --accent:#8b5cf6;
    --discord:#5865F2;
    --text:#f3f4f6;
    --text-muted:#d1d5db;
    --success:#10b981;
    --danger:#ef4444;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{
    font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
    background:linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
    color:var(--text);
    min-height:100vh;
    padding:20px;
  }
  .container{max-width:1200px;margin:0 auto;}
  
  /* Page de connexion */
  .login-page{
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:90vh;
  }
  .login-card{
    background:rgba(55,65,81,0.9);
    backdrop-filter:blur(30px);
    padding:50px;
    border-radius:24px;
    text-align:center;
    border:1px solid rgba(139,92,246,0.4);
    max-width:500px;
    width:100%;
  }
  .login-card .logo{
    width:100px;
    height:100px;
    background:linear-gradient(135deg,#8b5cf6,#ec4899);
    border-radius:24px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:3rem;
    margin:0 auto 30px;
  }
  .login-card h1{
    font-size:2.2rem;
    margin-bottom:10px;
    color:var(--text);
  }
  .login-card p{
    color:var(--text-muted);
    margin-bottom:40px;
    font-size:1.1rem;
  }
  .discord-btn{
    display:inline-flex;
    align-items:center;
    gap:12px;
    padding:16px 32px;
    background:var(--discord);
    border:none;
    border-radius:12px;
    color:white;
    font-size:1.1rem;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s;
  }
  .discord-btn:hover{
    background:#4752C4;
    transform:translateY(-3px);
    box-shadow:0 15px 35px rgba(88,101,242,0.4);
  }
  .discord-icon{
    width:24px;
    height:24px;
    fill:white;
  }
  
  /* Page principale (cach√©e par d√©faut) */
  .main-app{display:none;}
  .main-app.active{display:block;}
  
  /* Header avec ic√¥ne */
  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:20px;
    padding:30px;
    background:rgba(55,65,81,0.85);
    backdrop-filter:blur(20px);
    border-radius:20px;
    margin-bottom:30px;
    border:1px solid rgba(139,92,246,0.3);
  }
  .header-left{
    display:flex;
    align-items:center;
    gap:20px;
  }
  .header-icon{
    width:70px;
    height:70px;
    background:linear-gradient(135deg,#8b5cf6,#ec4899);
    border-radius:16px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:2.5rem;
    flex-shrink:0;
  }
  .header-content h1{
    font-size:2rem;
    font-weight:700;
    color:var(--text);
    margin-bottom:5px;
  }
  .header-content p{
    color:var(--text-muted);
    font-size:0.95rem;
  }
  .user-info{
    display:flex;
    align-items:center;
    gap:12px;
    padding:10px 20px;
    background:rgba(31,41,55,0.6);
    border-radius:12px;
  }
  .user-avatar{
    width:40px;
    height:40px;
    border-radius:50%;
    background:linear-gradient(135deg,#8b5cf6,#ec4899);
  }
  .user-name{
    color:var(--text);
    font-weight:600;
  }
  .logout-btn{
    padding:8px 16px;
    background:rgba(239,68,68,0.2);
    border:1px solid rgba(239,68,68,0.4);
    border-radius:8px;
    color:#ef4444;
    cursor:pointer;
    font-size:0.9rem;
    transition:all 0.3s;
  }
  .logout-btn:hover{
    background:rgba(239,68,68,0.3);
  }
  
  /* Navigation onglets */
  nav{
    display:flex;
    gap:10px;
    margin-bottom:30px;
    background:rgba(55,65,81,0.6);
    backdrop-filter:blur(20px);
    padding:12px;
    border-radius:16px;
    flex-wrap:wrap;
  }
  .nav-btn{
    padding:12px 24px;
    background:transparent;
    border:none;
    border-radius:12px;
    color:var(--text-muted);
    cursor:pointer;
    transition:all 0.3s;
    font-size:1rem;
    font-weight:500;
  }
  .nav-btn:hover{
    background:rgba(139,92,246,0.2);
    color:var(--text);
  }
  .nav-btn.active{
    background:var(--accent);
    color:white;
  }
  
  /* Pages */
  .section{display:none;}
  .section.active{display:block;}
  
  /* Cartes */
  .card{
    background:rgba(55,65,81,0.85);
    backdrop-filter:blur(20px);
    padding:30px;
    border-radius:20px;
    margin-bottom:20px;
    border:1px solid rgba(139,92,246,0.3);
  }
  .card h2{
    color:var(--text);
    margin-bottom:20px;
    font-size:1.6em;
    font-weight:600;
  }
  
  /* Formulaire */
  .form-group{margin-bottom:20px;}
  label{
    display:block;
    margin-bottom:8px;
    color:var(--text);
    font-weight:500;
  }
  input,select{
    width:100%;
    padding:12px;
    background:rgba(31,41,55,0.7);
    border:1px solid rgba(139,92,246,0.4);
    border-radius:10px;
    color:var(--text);
    font-size:1rem;
    transition:all 0.3s;
  }
  input:focus,select:focus{
    outline:none;
    border-color:var(--accent);
    background:rgba(31,41,55,0.9);
  }
  
  /* Bouton */
  .btn{
    padding:14px 28px;
    background:linear-gradient(135deg,var(--accent),#ec4899);
    border:none;
    border-radius:12px;
    color:white;
    cursor:pointer;
    font-size:1rem;
    font-weight:600;
    transition:all 0.3s;
    display:inline-block;
  }
  .btn:hover{
    transform:translateY(-2px);
    box-shadow:0 10px 25px rgba(139,92,246,0.4);
  }
  .btn:disabled{
    opacity:0.5;
    cursor:not-allowed;
    transform:none;
  }
  
  /* Status badge */
  .status{
    display:inline-block;
    padding:6px 14px;
    border-radius:20px;
    font-size:0.9em;
    font-weight:600;
    margin-left:10px;
  }
  .status.online{background:var(--success);color:white;}
  .status.offline{background:var(--danger);color:white;}
  
  /* Barre de progression */
  .progress-bar{
    width:100%;
    height:35px;
    background:rgba(31,41,55,0.7);
    border-radius:20px;
    overflow:hidden;
    margin:20px 0;
    border:1px solid rgba(139,92,246,0.3);
  }
  .progress-fill{
    height:100%;
    background:linear-gradient(90deg,var(--accent),#ec4899);
    transition:width 0.3s;
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-weight:600;
  }
  
  /* Logs console */
  .logs{
    background:rgba(31,41,55,0.8);
    padding:20px;
    border-radius:12px;
    max-height:400px;
    overflow-y:auto;
    font-family:'Courier New',monospace;
    font-size:0.9em;
    border:1px solid rgba(139,92,246,0.3);
  }
  .log-entry{
    padding:8px;
    border-bottom:1px solid rgba(139,92,246,0.1);
  }
  .log-info{color:#60a5fa;}
  .log-success{color:var(--success);}
  .log-error{color:var(--danger);}
  
  /* Grille statistiques */
  .stats-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:20px;
    margin-top:20px;
  }
  .stat-card{
    background:rgba(31,41,55,0.7);
    padding:25px;
    border-radius:16px;
    text-align:center;
    border:1px solid rgba(139,92,246,0.3);
    transition:all 0.3s;
  }
  .stat-card:hover{
    transform:translateY(-5px);
    border-color:var(--accent);
    box-shadow:0 10px 25px rgba(139,92,246,0.3);
  }
  .stat-value{
    font-size:2.5em;
    background:linear-gradient(135deg,var(--accent),#ec4899);
    -webkit-background-clip:text;
    background-clip:text;
    -webkit-text-fill-color:transparent;
    font-weight:700;
  }
  .stat-label{
    color:var(--text-muted);
    margin-top:8px;
    font-size:0.95em;
  }
  
  /* Scrollbar */
  ::-webkit-scrollbar{width:10px;}
  ::-webkit-scrollbar-track{background:rgba(31,41,55,0.5);}
  ::-webkit-scrollbar-thumb{
    background:var(--accent);
    border-radius:5px;
  }
</style>
</head>
<body>
<div class="container">
  
  <!-- PAGE DE CONNEXION -->
  <div id="loginPage" class="login-page">
    <div class="login-card">
      <div class="logo">üé®</div>
      <h1>Panel PDP V1</h1>
      <p>Connectez-vous avec Discord pour acc√©der au panel</p>
      <button class="discord-btn" onclick="loginWithDiscord()">
        <svg class="discord-icon" viewBox="0 0 24 24">
          <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
        </svg>
        Se connecter avec Discord
      </button>
    </div>
  </div>

  <!-- APPLICATION PRINCIPALE (cach√©e par d√©faut) -->
  <div id="mainApp" class="main-app">
    <!-- Header avec info utilisateur -->
    <header>
      <div class="header-left">
        <div class="header-icon">üé®</div>
        <div class="header-content">
          <h1>Panel PDP V1</h1>
          <p>Gestionnaire d'images Discord Bot</p>
        </div>
      </div>
      <div class="user-info">
        <div class="user-avatar" id="userAvatar"></div>
        <div class="user-name" id="userName">Utilisateur</div>
        <button class="logout-btn" onclick="logout()">D√©connexion</button>
      </div>
    </header>

    <!-- Navigation -->
    <nav>
      <button class="nav-btn active" onclick="showSection('accueil')">üè† Accueil</button>
      <button class="nav-btn" onclick="showSection('importer')">üì• Importer</button>
      <button class="nav-btn" onclick="showSection('dashboard')">üìä Dashboard</button>
      <button class="nav-btn" onclick="showSection('logs')">üìù Logs</button>
    </nav>

    <!-- ACCUEIL -->
    <div id="accueil" class="section active">
      <div class="card">
        <h2>Statut du Bot</h2>
        <div id="botStatus">Chargement...</div>
      </div>
    </div>

    <!-- IMPORTER -->
    <div id="importer" class="section">
      <div class="card">
        <h2>Importer des Images</h2>
        <form onsubmit="startScrape(event)">
          <div class="form-group">
            <label>URL Pinterest</label>
            <input type="url" id="pinterestUrl" placeholder="https://pinterest.com/search/pins/?q=..." required>
          </div>
          <div class="form-group">
            <label>Cat√©gorie</label>
            <select id="category" required>
              <option value="boy">Boy</option>
              <option value="girl">Girl</option>
              <option value="anime">Anime</option>
              <option value="pdp">PDP</option>
              <option value="match">Match</option>
            </select>
          </div>
          <div class="form-group">
            <label>Nombre d'images (1-1000)</label>
            <input type="number" id="limit" min="1" max="1000" value="100" required>
          </div>
          <button type="submit" class="btn" id="scrapeBtn">üöÄ Lancer l'import</button>
        </form>
        
        <div id="scrapeProgress" style="display:none;">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width:0%;">0%</div>
          </div>
          <p id="progressText" style="text-align:center;color:var(--text-muted);margin-top:10px;"></p>
        </div>
      </div>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard" class="section">
      <div class="card">
        <h2>Statistiques</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="stat-total">0</div>
            <div class="stat-label">Total Images</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-boy">0</div>
            <div class="stat-label">Boy</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-girl">0</div>
            <div class="stat-label">Girl</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-anime">0</div>
            <div class="stat-label">Anime</div>
          </div>
        </div>
      </div>
    </div>

    <!-- LOGS -->
    <div id="logs" class="section">
      <div class="card">
        <h2>Logs du syst√®me</h2>
        <div class="logs" id="logsContainer">
          <div class="log-entry log-info">[Syst√®me] Panel initialis√©</div>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
// ‚úÖ Configuration
const API_URL = "https://pfpbot-8e9l.onrender.com";
const DISCORD_CLIENT_ID = "1444812896495206592"; // ‚úÖ Votre Client ID Discord
const REDIRECT_URI = window.location.origin + window.location.pathname;

let currentSection = 'accueil';

// V√©rifier si l'utilisateur est connect√© au chargement
window.onload = function() {
  checkAuth();
  handleOAuthCallback();
};

function checkAuth() {
  const user = localStorage.getItem('discord_user');
  if (user) {
    showMainApp(JSON.parse(user));
  } else {
    showLoginPage();
  }
}

function showLoginPage() {
  document.getElementById('loginPage').style.display = 'flex';
  document.getElementById('mainApp').classList.remove('active');
}

function showMainApp(user) {
  document.getElementById('loginPage').style.display = 'none';
  document.getElementById('mainApp').classList.add('active');
  
  // Afficher les infos utilisateur
  document.getElementById('userName').textContent = user.username;
  if (user.avatar) {
    document.getElementById('userAvatar').style.backgroundImage = 
      `url(https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png)`;
  }
  
  loadBotStatus();
}

function loginWithDiscord() {
  // ‚ö†Ô∏è IMPORTANT: Vous devez cr√©er une application Discord et obtenir un CLIENT_ID
  // https://discord.com/developers/applications
  
  // Scopes: identify (nom+avatar) + guilds.join (rejoindre serveurs)
  const scope = 'identify guilds.join';
  const discordAuthUrl = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=${scope}`;
  
  window.location.href = discordAuthUrl;
}

function handleOAuthCallback() {
  const hash = window.location.hash.substring(1);
  const params = new URLSearchParams(hash);
  const accessToken = params.get('access_token');
  
  if (accessToken) {
    // R√©cup√©rer les infos utilisateur
    fetch('https://discord.com/api/users/@me', {
      headers: {
        'Authorization': `Bearer ${accessToken}`
      }
    })
    .then(res => res.json())
    .then(user => {
      localStorage.setItem('discord_user', JSON.stringify(user));
      localStorage.setItem('discord_token', accessToken);
      window.location.hash = '';
      showMainApp(user);
    })
    .catch(err => {
      console.error('Erreur OAuth:', err);
      alert('Erreur lors de la connexion Discord');
    });
  }
}

function logout() {
  localStorage.removeItem('discord_user');
  localStorage.removeItem('discord_token');
  showLoginPage();
}

function showSection(section) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(section).classList.add('active');
  event.target.classList.add('active');
  currentSection = section;
  
  if(section === 'accueil') loadBotStatus();
  if(section === 'dashboard') loadStats();
}

async function loadBotStatus() {
  try {
    addLog('Connexion √† l\'API...', 'info');
    const response = await fetch(`${API_URL}/health`);
    const data = await response.json();
    
    const statusHtml = `
      <p style="font-size:1.3em;margin:20px 0;">
        Bot: <strong>${data.bot || 'N/A'}</strong> 
        <span class="status ${data.status === 'online' ? 'online' : 'offline'}">
          ${data.status === 'online' ? 'üü¢ En ligne' : 'üî¥ Hors ligne'}
        </span>
      </p>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value">${data.guilds || 0}</div>
          <div class="stat-label">Serveurs</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${data.users || 0}</div>
          <div class="stat-label">Utilisateurs</div>
        </div>
      </div>
    `;
    document.getElementById('botStatus').innerHTML = statusHtml;
    addLog('‚úÖ Bot connect√© avec succ√®s', 'success');
  } catch(error) {
    document.getElementById('botStatus').innerHTML = '<p style="color:var(--danger);font-size:1.1em;">‚ùå Erreur de connexion √† l\'API</p>';
    addLog('‚ùå Erreur: ' + error.message, 'error');
  }
}

async function startScrape(event) {
  event.preventDefault();
  
  const url = document.getElementById('pinterestUrl').value;
  const category = document.getElementById('category').value;
  const limit = document.getElementById('limit').value;
  
  document.getElementById('scrapeBtn').disabled = true;
  document.getElementById('scrapeProgress').style.display = 'block';
  
  addLog(`üöÄ D√©marrage import: ${limit} images (${category})`, 'info');
  
  try {
    const response = await fetch(`${API_URL}/scrape`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ url, category, limit: parseInt(limit) })
    });
    
    const result = await response.json();
    
    if(result.status === 'success') {
      updateProgress(100, `‚úÖ Import termin√©: ${result.count || limit} images`);
      addLog(`‚úÖ Import r√©ussi: ${result.count || limit} images ajout√©es`, 'success');
    } else {
      updateProgress(0, '‚ùå √âchec de l\'import');
      addLog('‚ùå Erreur: ' + (result.message || 'Erreur inconnue'), 'error');
    }
  } catch(error) {
    updateProgress(0, '‚ùå Erreur de connexion');
    addLog('‚ùå Erreur: ' + error.message, 'error');
  }
  
  document.getElementById('scrapeBtn').disabled = false;
  setTimeout(() => {
    document.getElementById('scrapeProgress').style.display = 'none';
  }, 3000);
}

function updateProgress(percent, text) {
  document.getElementById('progressFill').style.width = percent + '%';
  document.getElementById('progressFill').textContent = percent + '%';
  document.getElementById('progressText').textContent = text;
}

async function loadStats() {
  try {
    const response = await fetch(`${API_URL}/stats`);
    const stats = await response.json();
    
    document.getElementById('stat-total').textContent = stats.total_images || 0;
    document.getElementById('stat-boy').textContent = stats.categories?.boy || 0;
    document.getElementById('stat-girl').textContent = stats.categories?.girl || 0;
    document.getElementById('stat-anime').textContent = stats.categories?.anime || 0;
    
    addLog('üìä Statistiques charg√©es', 'success');
  } catch(error) {
    addLog('‚ùå Erreur chargement stats', 'error');
  }
}

function addLog(message, type = 'info') {
  const logsContainer = document.getElementById('logsContainer');
  const timestamp = new Date().toLocaleTimeString('fr-FR');
  const logEntry = document.createElement('div');
  logEntry.className = `log-entry log-${type}`;
  logEntry.textContent = `[${timestamp}] ${message}`;
  logsContainer.appendChild(logEntry);
  logsContainer.scrollTop = logsContainer.scrollHeight;
}

// Auto-refresh toutes les 30 secondes
setInterval(() => {
  if(document.getElementById('mainApp').classList.contains('active')) {
    if(currentSection === 'accueil') loadBotStatus();
    if(currentSection === 'dashboard') loadStats();
  }
}, 30000);
</script>
</body>
</html>
